# Batmobile: Car Price Prediction
[![SkillFactory Data Science](https://img.shields.io/badge/SF-Data%20Science-brightgreen)](https://skillfactory.ru/data-science)
[![Kaggle](https://img.shields.io/badge/-Kaggle-34b6ef?logo=Kaggle&logoColor=white)](https://www.kaggle.com/c/sf-dst-car-price-prediction-part2)\
![TF](https://img.shields.io/badge/-TensorFlow-FF6F00?logo=TensorFlow&logoColor=white)
![NLP](https://img.shields.io/badge/Deep_Learning-NLP-1f8280)

Этот [финальный проект](https://www.kaggle.com/c/sf-dst-car-price-prediction-part2) курса _Real Data Science_ подводил итоги обучения по курсам _Machine Learning_ и _Deep Learning_ и являлся продолжением соревнования ([Project 3. Car Price Prediction](https://github.com/macsunmood/SkillFactory_RDS/tree/master/Project%203.%20Car%20Price%20Prediction)), но уже с дополнительными данными (текст и изображения).

Задача заключалась в доведении работы по созданию модели, предсказывающей стоимость автомобиля, до логического завершения: обогатить датасет текстовыми данными из объявлений о продаже и свести все модели в единое решение — **Multiple Inputs сеть**.

> Эффективно работающая, такая модель позволит быстро выявлять выгодные предложения, что **значительно ускорит работу менеджеров и повысит прибыль компании**.

## Описание и ход работы

### Целевая метрика:

- **[MAPE](http://en.wikipedia.org/wiki/Mean_absolute_percentage_error)** (mean absolute percentage error) — **средняя абсолютная ошибка в процентах**:

![MAPE](https://render.githubusercontent.com/render/math?math=MAPE%20=%20\dfrac{100}{n}%20\sum_{t=1}^{n}%20\frac{|Yt%20-%20\hat{Y}_t|}{Yt})

```
Где:
Yt – фактическое значение за анализируемый период;
Ŷt — значение прогнозной модели за анализируемый период;
n — количество периодов.
```

Предоставлялся готовый датасет с изображениями, табличными данными и текстовыми описаниями.\
Было разрешено использовать любые ML и DL алгоритмы и библиотеки.\
Задача — предсказать стоимость автомобиля по его характеристикам, текстовому описанию и картинке.

### Основные этапы:

<details>
  <summary><b>Разработка baseline решения:</b></summary>

  1. _Построение «наивной» ML-модели на табличных данных._\
  Для начала была построена самая простая модель, которая предсказывала среднюю цену по модели автомобиля и году его выпуска.

  2. _Обработка и нормирование признаков, построение первой модели на основе градиентного бустинга с помощью **CatBoost**._\
  На этом этапе был проведён **EDA**, что выявило ненормальное распределение числовых признаков.
  Далее сделана предобработка данных: удалено лишнее, заполнены пропуски, выполнено нормирование, применены **Label Encoding** и **One-Hot Encoding**.

  3. _Попытка решения задачи с помощью **DL** (модель на Tabular данных) и сравнение результатов._\
  Была построена простая нейронная сеть (Dense-модель) из трёх слоёв с дропаутами.

  4. _Добавление текстовых данных (**NLP**) и организация **Multi-Input** нейронной сети (табличные данные + текст)._\
  Произведена векторизация текста и построена **LSTM-сеть** для его обработки. Добавлена ещё одна сеть — созданная ранее для табличных данных.
  Затем их выходы были объединены в **Multi-Input сеть** для обработки и табличных данных, и текста одновременно.

  5. _Добавление обработки изображений в Multi-Input нейронную сеть._\
  Добавлена сверточная сеть для анализа изображений с помощью **EfficientNet** (перенос обучения **EfficientNetB3**).
  Для подачи данных при обучении keras-модели использован итератор **tf.data.Dataset**.
  Multi-Input сеть: добавлена обработка изображений и объединены выходы трёх нейросетей (табличные данные + текст + изображения).
  Датасет небольшой, поэтому сделана аугментация изображений с помощью библиотеки **albumentations**.

  6. _**Ансамблирование** градиентного бустинга и нейронной сети._ \
  На этом этапе был произведен **blending** сетей с усреднением их показаний.

  7. _Проброс признака._ \
  Для усиления акцента на признаке `productiondate` для него добавлен ещё один слой `L.Input`.
</details>
